<?php
 namespace Plugin\AmazonPayments\Repository; use Doctrine\ORM\EntityRepository; class AmazonInfoRepository extends EntityRepository { protected $app; public function setApplication($app) { $this->app = $app; } public function getSettingData() { $AmazonInfo = $this->find(1); return unserialize($AmazonInfo->getSettingData()); } public function getAmazonPayment() { return $this->find(1)->getPayment(); } public function getAmazonSettings($setting = false) { $this->const = $this->app['config']['AmazonPayments']['const']; $amazonSettings = $this->getSettingData(); if (isset($amazonSettings['amazon_account_mode']) && $amazonSettings['amazon_account_mode'] == 1) { if (isset($amazonSettings['prod_mode']) && $amazonSettings['prod_mode'] == 1) { $amazonSettings['mws_endpoint'] = 'https://mws.amazonservices.jp/OffAmazonPayments/2013-01-01'; $amazonSettings['widget_url'] = 'https://static-fe.payments-amazon.com/OffAmazonPayments/jp/lpa/js/Widgets.js'; $amazonSettings['profile_api_endpoint'] = 'https://api.amazon.co.jp/'; $amazonSettings['service_version'] = '2013-01-01'; $amazonSettings['mws_auth_token'] = ''; } else { $amazonSettings['mws_endpoint'] = 'https://mws.amazonservices.jp/OffAmazonPayments_Sandbox/2013-01-01'; $amazonSettings['widget_url'] = 'https://origin-na.ssl-images-amazon.com/images/G/09/EP/offAmazonPayments/sandbox/prod/lpa/js/Widgets.js'; $amazonSettings['profile_api_endpoint'] = 'https://api-sandbox.amazon.co.jp/'; $amazonSettings['service_version'] = '2013-01-01'; $amazonSettings['mws_auth_token'] = ''; } } else { if ($setting !== true) { $amazonSettings['seller_id'] = $this->const['TEST_SELLER_ID']; $amazonSettings['mws_access_key_id'] = $this->const['TEST_MWS_ACCESS_KEY_ID']; $amazonSettings['mws_secret_access_key'] = $this->const['TEST_MWS_SECRET_ACCESS_KEY']; $amazonSettings['client_id'] = $amazonSettings['test_client_id']; } $amazonSettings['mws_endpoint'] = 'https://mws.amazonservices.jp/OffAmazonPayments_Sandbox/2013-01-01'; $amazonSettings['widget_url'] = 'https://origin-na.ssl-images-amazon.com/images/G/09/EP/offAmazonPayments/sandbox/prod/lpa/js/Widgets.js'; $amazonSettings['profile_api_endpoint'] = 'https://api-sandbox.amazon.co.jp/'; $amazonSettings['service_version'] = '2013-01-01'; $amazonSettings['mws_auth_token'] = ''; } return $amazonSettings; } function registerSettings($settingData) { $AmazonInfo = $this ->find(1) ->setSettingData(serialize($settingData)); $em = $this->getEntityManager(); $em->persist($AmazonInfo); $em->flush(); } } 